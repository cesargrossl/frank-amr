#!/usr/bin/env python3
import time
import gpiod  # libgpiod v2

# Ajuste conforme seu sistema: geralmente "gpiochip0" no Pi
CHIP_NAME = "gpiochip0"
IN7 = 17   # pino físico 11
IN8 = 27   # pino físico 13

# Abre o chip e requisita as linhas como saída
chip = gpiod.Chip(CHIP_NAME)
req = chip.request_lines(
    consumer="reles",
    config={
        (IN7,): gpiod.LineSettings(direction=gpiod.LineDirection.OUTPUT, output_value=gpiod.LineValue.HIGH),
        (IN8,): gpiod.LineSettings(direction=gpiod.LineDirection.OUTPUT, output_value=gpiod.LineValue.HIGH),
    }
)
# Agora as linhas estão sob seu controle e não “flutuam”.

def relay_on(pin):   # liga (ativo em LOW)
    req.set_value(pin, gpiod.LineValue.LOW)

def relay_off(pin):  # desliga (HIGH)
    req.set_value(pin, gpiod.LineValue.HIGH)

try:
    print("Ligando IN7 (GPIO17) por 2s…")
    relay_on(IN7)
    time.sleep(2)

    print("Desliga IN7, liga IN8 (GPIO27) por 2s…")
    relay_off(IN7)
    relay_on(IN8)
    time.sleep(2)

    print("Desligando IN8…")
    relay_off(IN8)

finally:
    # Garante tudo desligado e libera as linhas
    try:
        relay_off(IN7)
        relay_off(IN8)
    except Exception:
        pass
    req.release()
    chip.close()
